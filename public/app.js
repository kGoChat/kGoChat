(function(e){function n(n){for(var r,a,i=n[0],c=n[1],l=n[2],d=0,f=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(n);while(f.length)f.shift()();return s.push.apply(s,l||[]),t()}function t(){for(var e,n=0;n<s.length;n++){for(var t=s[n],r=!0,i=1;i<t.length;i++){var c=t[i];0!==o[c]&&(r=!1)}r&&(s.splice(n--,1),e=a(a.s=t[0]))}return e}var r={},o={app:0},s=[];function a(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=r,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)a.d(t,r,function(n){return e[n]}.bind(null,r));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=n,i=i.slice();for(var l=0;l<i.length;l++)n(i[l]);var u=c;s.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"034f":function(e,n,t){"use strict";var r=t("3ebb"),o=t.n(r);o.a},"0fd1":function(e,n,t){t("d3b7"),t("4d63"),t("ac1f"),t("25f0"),t("5319");var r=t("7037");(function(){var e=function(e){if(arguments.length>0){var n=this;if(1===arguments.length&&"object"===r(e))for(var t in e){var o=new RegExp("({"+t+"})","g");e.hasOwnProperty(t)&&(n=n.replace(o,e[t]))}else for(var s=0;s<arguments.length;s++){if(void 0===arguments[s])return"";var a=new RegExp("({["+s+"]})","g");n=n.replace(a,arguments[s])}return n}return this};Object.defineProperty(String.prototype,"format",{enumerable:!1,configurable:!1,get:function(){return e.bind(this)}}),Object.defineProperty(String.prototype,"toDate",{enumerable:!1,configurable:!1,get:function(){var e=this;return function(){return new Date(Date.parse(e))}}});var n={"y+":function(e,n){e.setFullYear(e.getFullYear()+n)},"M+":function(e,n){e.setMonth(e.getMonth()+n)},"d+":function(e,n){e.setDate(e.getDate()+n)},"h+":function(e,n){e.setHours(e.getHours()+n)},"m+":function(e,n){e.setMinutes(e.getMinutes()+n)},"s+":function(e,n){e.setSeconds(e.getSeconds()+n)},S:function(e,n){e.setMilliseconds(e.getMilliseconds()+n)}},t=function(e,t){switch(e){case"y":n["y+"](this,t);break;case"M":n["M+"](this,t);break;case"d":n["d+"](this,t);break;case"h":n["h+"](this,t);break;case"m":n["m+"](this,t);break;case"s":n["s+"](this,t);break;case"S":n["S"](this,t);break;default:break}return this},o=function(e){if(!e)return this.toString();for(var t in n)if(new RegExp(t+"([\\+-]{1}\\d+)+").test(e)){var r=parseInt(RegExp.$1);this.Add(t[0],r),e=e.replace(RegExp.$1,"")}var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[s]:("00"+o[s]).substr((""+o[s]).length)));return e};Object.defineProperty(Date.prototype,"format",{enumerable:!1,configurable:!1,get:function(){return o.bind(this)}}),Object.defineProperty(Date.prototype,"Add",{enumerable:!1,configurable:!1,get:function(){return t.bind(this)}});var s=Date.parse,a=/[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*/g;Date.parse=function(e){var n=s.bind(this)(e);if(!n){var t=new RegExp(a).exec(e);if(null!=t){for(var r=1;r<t.length;r++)t[r]=parseInt(t[r]),t[r]||(t[r]=0);n=new Date(t[1],t[2]-1,t[3],t[4],t[5],t[6]).getTime()}}return n}})()},"0fe2":function(e,n,t){"use strict";var r=t("d914"),o=t.n(r);o.a},"203d":function(e,n,t){var r=t("24fb");n=r(!0),n.push([e.i,"#app[data-v-053f99e5]{position:absolute;left:0;right:0;top:0;bottom:0}","",{version:3,sources:["/Volumes/work/golang/kGoChat/k-go-chat-vue/src/src/App.vue"],names:[],mappings:"AAaA,sBACA,iBAAA,CACA,MAAA,CACA,OAAA,CACA,KAAA,CACA,QACA",file:"App.vue",sourcesContent:['<template>\n    <div id="app">\n        <router-view/>\n    </div>\n</template>\n<style>\n    * {\n        padding: 0;\n        margin: 0;\n        box-sizing: border-box;\n    }\n</style>\n<style scoped>\n    #app {\n        position: absolute;\n        left: 0;\n        right: 0;\n        top: 0;\n        bottom: 0;\n    }\n\n</style>\n']}]),e.exports=n},"3ebb":function(e,n,t){var r=t("e31a");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=t("499e").default;o("517436b3",r,!0,{sourceMap:!0,shadowMode:!1})},"56d7":function(e,n,t){"use strict";t.r(n);t("e260"),t("e6cf"),t("cca6"),t("a79d");var r=t("2b0e"),o=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],a=(t("034f"),t("0fe2"),t("2877")),i={},c=Object(a["a"])(i,o,s,!1,null,"053f99e5",null),l=c.exports,u=t("5c96"),d=t.n(u),f=(t("0fae"),t("8c4f")),p=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"home"},[t("div",{staticStyle:{padding:"0.5em"}},[t("el-card",{staticClass:"box-card",staticStyle:{width:"600px","max-width":"100%"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("账户登录")])]),t("div",{staticClass:"item"},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-input",{model:{value:e.user,callback:function(n){e.user=n},expression:"user"}},[t("template",{slot:"prepend"},[e._v("登录用户")])],2)],1),t("el-col",{attrs:{span:4}},[t("el-button",{on:{click:function(n){return e.Login()}}},[e._v("登录")])],1)],1)],1),t("div",{staticClass:"item"},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-input",{model:{value:e.toUser,callback:function(n){e.toUser=n},expression:"toUser"}},[t("template",{slot:"prepend"},[e._v("用户")])],2)],1)],1)],1),t("div",{staticClass:"item"},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-input",{model:{value:e.message,callback:function(n){e.message=n},expression:"message"}},[t("template",{slot:"prepend"},[e._v("消息")])],2)],1),t("el-col",{attrs:{span:4}},[t("el-button",{on:{click:function(n){return e.sendChat()}}},[e._v("发送")])],1)],1)],1),t("div",{staticClass:"item"},[t("el-row",[t("el-col",{attrs:{span:4}},[e._v(" 消息 ")]),t("el-col",{attrs:{span:20}},[t("el-input",{attrs:{type:"textarea",readonly:"readonly",rows:"5","show-word-limit":""},model:{value:e.other_message,callback:function(n){e.other_message=n},expression:"other_message"}})],1)],1)],1),t("div",{staticClass:"item"},[t("el-row",[t("el-col",{attrs:{span:22}},[t("el-button",{on:{click:function(n){return e.InitWebRTC()}}},[e._v("建立 WebRTC 通道")])],1),t("el-col",{attrs:{span:2}},[t("el-switch",{attrs:{"aria-readonly":"true",readonly:"readonly",disabled:"disabled","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.webRtcState,callback:function(n){e.webRtcState=n},expression:"webRtcState"}})],1)],1)],1)])],1),e._e()],1)},h=[],b=(t("99af"),t("96cf"),t("1da1")),g=(t("d3b7"),t("ac1f"),t("5319"),t("c975"),t("25f0"),t("53ca")),m=0,v=1,w=2,y=4,C="iris-websocket-message:",k=";",R=C.length,O=k.length,x=R+O-1,A=function(){function e(e,n){var t=this;this.connectListeners=[],this.disconnectListeners=[],this.nativeMessageListeners=[],this.messageListeners={},window["WebSocket"]&&(-1===e.indexOf("ws")&&(e="ws://"+e),null!=n&&n.length>0?this.conn=new WebSocket(e,n):this.conn=new WebSocket(e),this.conn.onopen=function(e){return t.fireConnect(),t.isReady=!0,null},this.conn.onclose=function(e){return t.fireDisconnect(),null},this.conn.onmessage=function(e){t.messageReceivedFromConn(e)})}return e.prototype.isNumber=function(e){return!isNaN(e-0)&&null!==e&&""!==e&&!1!==e},e.prototype.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},e.prototype.isBoolean=function(e){return"boolean"===typeof e||"object"===Object(g["a"])(e)&&"boolean"===typeof e.valueOf()},e.prototype.isJSON=function(e){return"object"===Object(g["a"])(e)},e.prototype._msg=function(e,n,t){return C+e+k+String(n)+k+t},e.prototype.encodeMessage=function(e,n){var t="",r=0;return this.isNumber(n)?(r=v,t=n.toString()):this.isBoolean(n)?(r=w,t=n.toString()):this.isString(n)?(r=m,t=n.toString()):this.isJSON(n)?(r=y,t=JSON.stringify(n)):null!==n&&"undefined"!==typeof n&&console.log("unsupported type of input argument passed, try to not include this argument to the 'Emit'"),this._msg(e,r,t)},e.prototype.decodeMessage=function(e,n){var t=R+O+e.length+2;if(n.length<t+1)return null;var r=parseInt(n.charAt(t-2)),o=n.substring(t,n.length);return r===v?parseInt(o):r===w?Boolean(o):r===m?o:r===y?JSON.parse(o):null},e.prototype.getWebsocketCustomEvent=function(e){if(e.length<x)return"";var n=e.substring(x,e.length);return n.substring(0,n.indexOf(k))},e.prototype.getCustomMessage=function(e,n){var t=n.indexOf(e+k);return n.substring(t+e.length+k.length+2,n.length)},e.prototype.messageReceivedFromConn=function(e){var n=e.data;if(-1!==n.indexOf(C)){var t=this.getWebsocketCustomEvent(n);if(""!==t)return void this.fireMessage(t,this.getCustomMessage(t,n))}this.fireNativeMessage(n)},e.prototype.OnConnect=function(e){this.isReady&&e(),this.connectListeners.push(e)},e.prototype.fireConnect=function(){for(var e=0;e<this.connectListeners.length;e++)this.connectListeners[e]()},e.prototype.OnDisconnect=function(e){this.disconnectListeners.push(e)},e.prototype.fireDisconnect=function(){for(var e=0;e<this.disconnectListeners.length;e++)this.disconnectListeners[e]()},e.prototype.OnMessage=function(e){this.nativeMessageListeners.push(e)},e.prototype.fireNativeMessage=function(e){for(var n=0;n<this.nativeMessageListeners.length;n++)this.nativeMessageListeners[n](e)},e.prototype.On=function(e,n){null!=this.messageListeners[e]&&void 0!==this.messageListeners[e]||(this.messageListeners[e]=[]),this.messageListeners[e].push(n)},e.prototype.fireMessage=function(e,n){for(var t in this.messageListeners)if(this.messageListeners.hasOwnProperty(t)&&t===e)for(var r=0;r<this.messageListeners[t].length;r++)this.messageListeners[t][r](n)},e.prototype.Disconnect=function(){this.conn.close()},e.prototype.EmitMessage=function(e){this.conn.send(e)},e.prototype.Emit=function(e,n){var t=this.encodeMessage(e,n);this.EmitMessage(t)},e}(),_=A,T=(t("fb6a"),t("c19f"),t("3ca3"),t("5cc6"),t("84c3"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),t("ddb0"),t("2b3d"),function(e){if(!e instanceof File)throw new Error("非文件");var n=this,t=e.size;Object.defineProperty(this,"FileTotal",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"file",{enumerable:!1,configurable:!1,get:function(){return e}});var r=new FileReader;Object.defineProperty(this,"reader",{enumerable:!1,configurable:!1,get:function(){return r}});var o=function(){n.reader.onprogress=function(e){}};o()});T.prototype={loaded:0,step:262144,readBlob:function(){var e=this;if(this.isReadEnd)throw new Error("文件已读取完毕");var n,t=this.file;if(t.slice){var r=this.loaded*this.step;n=t.slice(r,r+this.step)}else n=t;var o=this;return new Promise((function(t,r){o.reader.onload=function(e){o.loaded++,t(e.target.result)},o.reader.onerror=r,e.reader.readAsDataURL(n)}))}},Object.defineProperty(T.prototype,"isReadEnd",{enumerable:!1,configurable:!1,get:function(){return!(this.loaded*this.step<this.FileTotal)}}),T.ArrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},T.StringToArrayBuffer=function(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),r=0,o=e.length;r<o;r++)t[r]=e.charCodeAt(r);return n},T.Base64ToArrayBuffer=function(e){for(var n=atob(e),t=new ArrayBuffer(n.length),r=new Uint8Array(t),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return t},T.SaveFile=function(e,n,t){var r=new Uint8Array(e),o=new Blob([r]);if(navigator.appVersion.toString().indexOf(".NET")>0)window.navigator.msSaveBlob(o,n);else{var s=document.createElement("a");s.href=window.URL.createObjectURL(o),s.download=n,document.body.appendChild(s),s.click()}};var S=T,j=function(e){var n=this,t=null;this.connected=!1;var r=e.peerConfigure||e.peerConnectionConfigure||null;e.mediaConstraints=e.mediaConstraints||{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};var o=new RTCPeerConnection(r),s=function(){t.binaryType="arraybuffer",t.addEventListener("open",n._onopen),t.addEventListener("close",n._onclose),t.addEventListener("error",n._onerror),t.addEventListener("message",n._onmessage)};o.onicecandidate=function(n){if(n.candidate){var t={type:"candidate",label:n.candidate.sdpMLineIndex,id:n.candidate.sdpMid,candidate:n.candidate};e.onicecandidate&&e.onicecandidate(t)}},o.ondatachannel=function(e){t=e.channel,s()},Object.defineProperties(this,{$option:{value:e,configurable:!1,enumerable:!1},peerConnection:{value:o,configurable:!1,enumerable:!0,writable:!1},_localChannel:{get:function(){return t},set:function(e){t&&(t.close(),t=null),t=e},configurable:!1,enumerable:!0},_DataChannelLabel:{get:function(){return e.DataChannelLabel||e.ChannelLabel||e.data_channel_label||"kGoChat"},configurable:!1,enumerable:!0},_onopen:{configurable:!1,enumerable:!1,get:function(){return function(t){n.connected=!0;var r=e.onOpen||e.onopen||console.trace;r.call(n,t)}}},_onclose:{configurable:!1,enumerable:!1,get:function(){return function(t){n.connected=!1;var r=e.onClose||e.onclose||console.trace;r.call(n,t)}}},_onerror:{configurable:!1,enumerable:!1,get:function(){return function(t){var r=e.onError||e.onerror||console.trace;r.call(n,t)}}},_onmessage:{configurable:!1,enumerable:!1,get:function(){return function(t){var r=e.onMessage||e.onmessage||console.trace;r.call(n,t,t.data)}}}});var a=!1;if(Object.defineProperty(this,"addIceCandidate",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof n){e.next=8;break}e.prev=1,n=JSON.parse(n),e.next=8;break;case 5:throw e.prev=5,e.t0=e["catch"](1),e.t0;case 8:if(!a){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,a=!0,e.next=14,o.addIceCandidate(n);case 14:return e.abrupt("return",e.sent);case 17:throw e.prev=17,e.t1=e["catch"](10),a=!1,e.t1;case 21:case"end":return e.stop()}}),e,null,[[1,5],[10,17]])})));return function(n){return e.apply(this,arguments)}}()}}),e.master){var i={ordered:!0},c=n.peerConnection;this._localChannel=c.createDataChannel(n._DataChannelLabel,i),this._localChannel.binaryType="arraybuffer",s()}};Object.defineProperty(j.prototype,"type",{value:"WebRTC",configurable:!1,writable:!1}),Object.defineProperty(j.prototype,"createOffer",{configurable:!1,get:function(){return function(){var e=this;return new Promise(function(){var n=Object(b["a"])(regeneratorRuntime.mark((function n(t,r){var o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.peerConnection,n.next=3,o.createOffer(e.$option.mediaConstraints);case 3:return s=n.sent,n.next=6,o.setLocalDescription(s);case 6:t(s);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}}}),Object.defineProperty(j.prototype,"send",{configurable:!1,get:function(){return function(e){var n=this;return new Promise(function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(r,o){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n._localChannel.send(e);case 2:r();case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}}),Object.defineProperty(j.prototype,"close",{configurable:!1,get:function(){return function(){var e=this;return new Promise(function(){var n=Object(b["a"])(regeneratorRuntime.mark((function n(t,r){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=e._localChannel,!n.t0){n.next=4;break}return n.next=4,e._localChannel.close();case 4:t();case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}}}),Object.defineProperty(j.prototype,"handleOffer",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(n){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof n){e.next=9;break}e.prev=1,n=JSON.parse(n),e.next=9;break;case 5:return e.prev=5,e.t0=e["catch"](1),console.trace(e.t0),e.abrupt("return");case 9:return t=this.peerConnection,e.next=12,t.setRemoteDescription(new RTCSessionDescription(n));case 12:return e.next=14,t.createAnswer();case 14:return r=e.sent,e.next=17,t.setLocalDescription(r);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(n){return e.apply(this,arguments)}}()}}),Object.defineProperty(j.prototype,"handleAnswer",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof n){e.next=9;break}e.prev=1,n=JSON.parse(n),e.next=9;break;case 5:return e.prev=5,e.t0=e["catch"](1),console.trace(e.t0),e.abrupt("return");case 9:return t=this.peerConnection,e.next=12,t.setRemoteDescription(new RTCSessionDescription(n));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(n){return e.apply(this,arguments)}}()}}),Object.defineProperty(j.prototype,"handleCandidate",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.peerConnection,e.next=3,t.addIceCandidate(new RTCIceCandidate(n));case 3:case"end":return e.stop()}}),e,this)})));return function(n){return e.apply(this,arguments)}}()}}),window.WebRTC=j;var W=j,M=(t("3fd3"),function(e){var n="".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.host,"/websocket"),t=new _(n),r=this,o=0;this.callback_lists=[],Object.defineProperty(this,"callback_list_index",{enumerable:!1,configurable:!1,get:function(){return o++,o>99999999&&(o=1),o}}),t.OnConnect((function(){e.OnConnect&&e.OnConnect.call(r)})),t.On("Chat",(function(n){try{n=JSON.parse(n)}catch(o){}var t=n.fnId;if(delete n.fnId,n.code>=0){if(t&&r.callback_lists[t]){try{r.callback_lists[t][0](n)}finally{delete r.callback_lists[t]}return}if(t&&r.callback_lists[t]){try{r.callback_lists[t][1](n)}finally{delete r.callback_lists[t]}return}}e.OnChat&&e.OnChat.call(r,n)}));var s="";t.On("User",(function(n){try{n=JSON.parse(n)}catch(o){}var t=n.fnId;if(delete n.fnId,n.code>=0){switch(n.type){case"Login":s=n.data.user;break}if(t&&r.callback_lists[t]){try{r.callback_lists[t][0](n)}finally{delete r.callback_lists[t]}return}}else if(t&&r.callback_lists[t]){try{r.callback_lists[t][1](n)}finally{delete r.callback_lists[t]}return}e.OnUser&&e.OnUser.call(r,n)})),t.On("WebRTC",(function(n){try{n=JSON.parse(n)}catch(s){}var t=n.fnId;if(delete n.fnId,n.code>=0){if("WebRTC"===n.type){var o=n.data;switch(o.type){case"candidate":return void r._update_candidate(o.data).then((function(e){e&&console.log(e)})).catch(console.error);case"offer":return void Object(b["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.InitWebRTC(!1,o.user);case 2:return e.next=4,r._handleOffer(o.data);case 4:n=e.sent,r.sendWebRTC({code:0,type:"WebRTC",data:{type:"answer",user:o.user,data:n},remarks:""});case 6:case"end":return e.stop()}}),e)})))();case"answer":return void r._handleAnswer(o.data).then((function(e){e&&console.log(e)})).catch(console.error)}}else if("WebRTCBack"===n.type&&t&&r.callback_lists[t]){try{r.callback_lists[t][0](n)}finally{delete r.callback_lists[t]}return}}else if(t&&r.callback_lists[t]){try{r.callback_lists[t][1](n)}finally{delete r.callback_lists[t]}return}e.OnWebRTC&&e.OnWebRTC.call(r,n)})),t.OnDisconnect((function(){e.OnDisconnect&&e.OnDisconnect.call(r)})),Object.defineProperty(this,"user",{enumerable:!0,configurable:!1,get:function(){return s}}),Object.defineProperty(this,"$socket",{enumerable:!1,configurable:!1,get:function(){return t}});var a=null;Object.defineProperty(this,"webRTC",{enumerable:!1,configurable:!1,get:function(){return a},set:function(e){a=e}}),Object.defineProperty(this,"$option",{enumerable:!1,configurable:!1,get:function(){return e}}),this.offer="{}",this.answer="{}",this.candidate="{}",this.other_candidate="{}",this.webRtcUser="";var i=!1;Object.defineProperty(this,"WebRtcConnected",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){var t=e.onWebRtcConnected||e.onwebrtcConnected||e.onwebrtcconnected||console.log,o=i;i=n,n!==o&&t&&t.call(r,n,o)}})});M.prototype={Disconnect:function(){this.FreeWebRTC(),this.$socket.Disconnect()},sendChat:function(e){return this.send("Chat",e)},sendWebRTC:function(e){return this.send("WebRTC",e)},sendUser:function(e){return this.send("User",e)},send:function(e,n){var t=this;return new Promise((function(r,o){var s=t.callback_list_index;n.fnId=s,t.callback_lists[s]=[r,o],t.$socket.Emit(e||"Chat",n)}))},peerConnectionConfigure:{iceServers:[{urls:["turn:59.63.25.236:3478?transport=udp","turn:59.63.25.236:3478?transport=tcp"],username:"kekxv",credential:"kekxv"},{urls:["stun:kekxv.com"],username:"",credential:""}],iceTransportPolicy:"all",iceCandidatePoolSize:"0"},InitWebRTC:function(e,n){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){var o,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.FreeWebRTC(),o=t,0!==t.user.length){r.next=4;break}throw{code:-1,message:"请先登录"};case 4:if(0!==n.length&&n!==t.user){r.next=6;break}throw{code:-1,message:"请不要与自己建立"};case 6:if(t.webRtcUser=n,t.webRTC=new W({peerConfigure:t.peerConnectionConfigure,DataChannelLabel:"kGoChat",master:e||!1,onopen:function(e){o.WebRtcConnected=!0},onclose:function(e){o.WebRtcConnected=!1},onerror:function(e){var n=o.$option.onWebRtcError||o.$option.onWebRtcerror||o.$option.onwebrtcerror;n&&n.call(o,e)},onmessage:function(e){var n=o.$option.onWebRTCmessage||o.$option.onWebRtcMessage||o.$option.onwebrtcmessage;n&&n.call(o,e)},onicecandidate:function(e){o.sendWebRTC({code:0,type:"WebRTC",data:{type:"candidate",user:t.webRtcUser,data:JSON.stringify(e.candidate)},remarks:""}).then((function(e){})).catch((function(e){console.log("error","candidate",e)}))}}),!e){r.next=13;break}return r.next=11,t._createOffer();case 11:return s=r.sent,r.abrupt("return",t.sendWebRTC({code:0,type:"WebRTC",data:{type:"offer",user:t.webRtcUser,data:s},remarks:""}).then((function(){})));case 13:case"end":return r.stop()}}),r)})))()},FreeWebRTC:function(){this.webRTC&&this.webRTC.close(),this.webRTC=null,this.WebRtcConnected=!1},_update_candidate:function(e){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.webRTC.addIceCandidate(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},_createOffer:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,e.webRTC.createOffer();case 3:return n.t1=n.sent,t=n.t0.stringify.call(n.t0,n.t1),n.abrupt("return",t);case 6:case"end":return n.stop()}}),n)})))()},_handleOffer:function(e){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,n.webRTC.handleOffer(e);case 3:return t.t1=t.sent,r=t.t0.stringify.call(t.t0,t.t1),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},_handleAnswer:function(e){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.webRTC.handleAnswer(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}};var $=M,L=function(e,n){this.title=e,this.options=n};L.prototype.Show=function(){var e=this;return window.Notification?"granted"===Notification.permission?this.popNotice():"denied"!==Notification.permission&&Notification.requestPermission().then((function(n){console.log(n),"granted"!==Notification.permission?e.popConfirm():e.popNotice()})):this.popConfirm(),this},L.prototype.popNotice=function(){var e=this;if("granted"===Notification.permission){var n=new Notification(e.title,e.options);n.onclick=function(){"undefined"!==typeof e.options.click&&e.options.click.call(e,e.options.data||null),n.close()},n.onclose=function(){"undefined"!==typeof e.options.close&&e.options.close.call(e,e.options.data||null)},n.onerror=function(){"undefined"!==typeof e.options.error&&e.options.error.call(e,e.options.data||null)},n.onshow=function(){"undefined"!==typeof e.options.show&&e.options.show.call(e,e.options.data||null)}}return e},L.prototype.popConfirm=function(){var e=confirm(this.title+"\n"+this.options.body);return"undefined"!==typeof this.options.show&&this.options.show.call(this),e?"undefined"!==typeof this.options.click&&this.options.click.call(this):"undefined"!==typeof this.options.error&&this.options.error.call(this),"undefined"!==typeof this.options.close&&this.options.close.call(this),this};var P={name:"Home",components:{},data:function(){return{user:"caesar",toUser:"caesar",message:"",other_message:"",webRtcState:!1,websocketApi:null,offer:"{}",answer:"{}",candidate:"{}",other_candidate:"{}"}},methods:{read:function(e){return Object(b["a"])(regeneratorRuntime.mark((function n(){var t,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=e.target.files,!(t&&t.length>0)){n.next=10;break}r=new S(t[0]);case 3:if(r.isReadEnd){n.next=9;break}return n.next=6,r.readBlob();case 6:n.sent,n.next=3;break;case 9:console.trace("read end");case 10:case"end":return n.stop()}}),n)})))()},InitWebRTC:function(){var e=this;this.websocketApi.InitWebRTC(!0,this.toUser).then((function(e){})).catch((function(n){e.$message.error(n.message)}))},Login:function(){var e=this;this.websocketApi.sendUser({code:0,type:"Login",data:{user:this.user},remarks:""}).then((function(n){e.$message.success(n.message)})).catch((function(n){e.$message.error(n.message)}))},sendChat:function(){var e=this;this.websocketApi.sendChat({code:0,type:"Chat",data:{user:this.toUser,message:this.message},remarks:""}).then((function(n){e.$message.success(n.message)})).catch((function(n){e.$message.error(n.message)}))},InitWebsocket:function(){var e=this;this.websocketApi=new $({OnConnect:function(){e.$message.success("连接成功")},OnDisconnect:function(){e.$message.warning("连接断开"),setTimeout((function(){e.InitWebsocket()}),3e3)},OnChat:function(n){0===n.code?"ChatBack"===n.type?e.$message.success(n.message):e.other_message="".concat(n.data.user,":").concat(n.data.message):e.$message.error(n.message)},OnUser:console.trace,OnWebRTC:console.trace,onwebrtcmessage:console.trace,onWebRtcConnected:function(n,t){e.webRtcState=n,n?(e.toUser=this.webRtcUser,e.$message.success("WebRtc 连接成功")):e.$message.error("WebRtc 断开连接")}})}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.InitWebsocket();case 1:case"end":return n.stop()}}),n)})))()},beforeDestroy:function(){this.websocketApi.Disconnect()}},D=P,E=(t("be2a"),Object(a["a"])(D,p,h,!1,null,"8b607b64",null)),I=E.exports;r["default"].use(f["a"]);var N=[{path:"/",name:"Home",component:I}],U=new f["a"]({routes:N}),B=U,F=t("2f62");r["default"].use(F["a"]);var J=new F["a"].Store({state:{},mutations:{},actions:{},modules:{}}),H=(t("0fd1"),t("9483"));Object(H["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),r["default"].config.productionTip=!1,r["default"].use(d.a),new r["default"]({router:B,store:J,render:function(e){return e(l)}}).$mount("#app")},"6d05":function(e,n,t){var r=t("24fb");n=r(!0),n.push([e.i,".item[data-v-8b607b64]{padding:.5em;text-align:center}[data-v-8b607b64] .item .el-row .el-col:first-child{text-align:left}[data-v-8b607b64] .item .el-row .el-col:last-child{text-align:right}","",{version:3,sources:["/Volumes/work/golang/kGoChat/k-go-chat-vue/src/views/src/views/Home.vue"],names:[],mappings:"AAiQA,uBACA,YAAA,CAIA,iBAHA,CAMA,oDACA,eACA,CACA,mDACA,gBACA",file:"Home.vue",sourcesContent:['<template>\n  <div class="home">\n\n    <div style="padding: 0.5em;">\n      <el-card class="box-card" style="width: 600px;max-width: 100%;">\n        <div slot="header" class="clearfix">\n          <span>账户登录</span>\n        </div>\n        <div class="item">\n          <el-row>\n            <el-col :span="20">\n              <el-input v-model="user">\n                <template slot="prepend">登录用户</template>\n              </el-input>\n            </el-col>\n            <el-col :span="4">\n              <el-button @click="Login()">登录</el-button>\n            </el-col>\n          </el-row>\n        </div>\n        <div class="item">\n          <el-row>\n            <el-col :span="24">\n              <el-input v-model="toUser">\n                <template slot="prepend">用户</template>\n              </el-input>\n            </el-col>\n          </el-row>\n        </div>\n        <div class="item">\n          <el-row>\n            <el-col :span="20">\n              <el-input v-model="message">\n                <template slot="prepend">消息</template>\n              </el-input>\n            </el-col>\n            <el-col :span="4">\n              <el-button @click="sendChat()">发送</el-button>\n            </el-col>\n          </el-row>\n        </div>\n        <div class="item">\n          <el-row>\n            <el-col :span="4">\n              消息\n            </el-col>\n            <el-col :span="20">\n              <el-input v-model="other_message" type="textarea" readonly="readonly" rows="5" show-word-limit/>\n            </el-col>\n          </el-row>\n        </div>\n\n        <div class="item">\n          <el-row>\n            <el-col :span="22">\n              <el-button @click="InitWebRTC()">建立 WebRTC 通道</el-button>\n            </el-col>\n            <el-col :span="2">\n              <el-switch aria-readonly="true" readonly="readonly" disabled="disabled"\n                         v-model="webRtcState"\n                         active-color="#13ce66"\n                         inactive-color="#ff4949">\n              </el-switch>\n            </el-col>\n          </el-row>\n        </div>\n      </el-card>\n    </div>\n    <el-card v-if="false" class="box-card" style="width: 600px;margin: 0.5em;">\n      <div slot="header" class="clearfix">\n        <span>WebRTC 交互</span>\n      </div>\n      <div class="item">\n        <el-button @click="Free()">重置</el-button>\n        <el-button @click="Init(true)">主初始化</el-button>\n        <el-button @click="Init(false)">从初始化</el-button>\n      </div>\n      <div class="item">\n        <el-row>\n          <el-col :span="12">\n            <el-input v-model="offer"/>\n          </el-col>\n          <el-col :span="6">\n            <el-button style="width: 9em;" @click="createOffer()">创建offer</el-button>\n          </el-col>\n          <el-col :span="6">\n            <el-button style="width: 9em;" @click="handleOffer()"><span>加载offer<br/>创建answer</span>\n            </el-button>\n          </el-col>\n        </el-row>\n      </div>\n      <div class="item">\n        <el-row>\n          <el-col :span="12">\n            <el-input v-model="answer"/>\n          </el-col>\n          <el-col :span="6">\n            <el-button style="width: 9em;" @click=""> &nbsp; .</el-button>\n          </el-col>\n          <el-col :span="6">\n            <el-button style="width: 9em;" @click="handleAnswer()">加载answer</el-button>\n          </el-col>\n        </el-row>\n      </div>\n      <div class="item">\n        <el-row>\n          <el-col :span="9" style="padding-right:0.5em;">\n            <el-input v-model="candidate"/>\n          </el-col>\n          <el-col :span="9" style="padding-right:0.5em;">\n            <el-input v-model="other_candidate"/>\n          </el-col>\n          <el-col :span="6">\n            <el-button style="width: 9em;" @click="update_candidate()">更新 candidate</el-button>\n          </el-col>\n        </el-row>\n      </div>\n\n    </el-card>\n\n\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\n\nimport websocketApi from "../assets/websocket-api";\nimport JsNotification from "../assets/JsTools/JsNotification";\nimport JsFileRead from "../assets/JsTools/JsFileRead";\nimport WebRTC from "../assets/JsTools/WebRTC";\n\n/**\n * @type {WebRTC|null}\n */\nlet webRTC = null;\nexport default {\n  name: \'Home\',\n  components: {},\n  data() {\n    return {\n      user: "caesar",\n      toUser: "caesar",\n      message: "",\n      other_message: "",\n      webRtcState: false,\n      websocketApi: null,\n      offer: "{}",\n      answer: "{}",\n      candidate: "{}",\n      other_candidate: "{}",\n    }\n  },\n  methods: {\n    async read(event) {\n      /**\n       * 文件列表\n       * @type {FileList || null }\n       */\n      let files = event.target.files;\n      if (files && files.length > 0) {\n        let jsFileRead = new JsFileRead(files[0]);\n        while (!jsFileRead.isReadEnd) {\n          let data = await jsFileRead.readBlob();\n          // sWebRTC.send(data);\n        }\n        console.trace("read end");\n      }\n    },\n\n    InitWebRTC() {\n      let self = this;\n      this.websocketApi.InitWebRTC(true, this.toUser).then((data) => {\n        // console.log("InitWebRTC", data);\n      }).catch((data) => {\n        self.$message.error(data.message);\n      });\n    },\n\n    Login() {\n      let self = this;\n      this.websocketApi.sendUser({\n        code: 0,\n        type: "Login",\n        data: {"user": this.user},\n        remarks: "",\n      }).then((data) => {\n        self.$message.success(data.message);\n      }).catch((data) => {\n        self.$message.error(data.message);\n      });\n    },\n    sendChat() {\n      let self = this;\n      this.websocketApi.sendChat({\n        code: 0,\n        type: "Chat",\n        data: {\n          user: this.toUser,\n          message: this.message,\n        },\n        remarks: "",\n      }).then((data) => {\n        self.$message.success(data.message);\n      }).catch((data) => {\n        self.$message.error(data.message);\n      });\n    },\n    InitWebsocket() {\n      let self = this;\n      this.websocketApi = new websocketApi({\n        OnConnect() {\n          self.$message.success("连接成功");\n        },\n        OnDisconnect() {\n          self.$message.warning("连接断开");\n          setTimeout(() => {\n            self.InitWebsocket();\n          }, 3000);\n        },\n\n        OnChat(data) {\n          if (data.code === 0) {\n            if (data.type === "ChatBack") {\n              self.$message.success(data.message);\n            } else\n              self.other_message = `${data.data.user}:${data.data.message}`\n          } else {\n            self.$message.error(data.message);\n          }\n        },\n        OnUser: console.trace,\n        OnWebRTC: console.trace,\n        onwebrtcmessage: console.trace,\n        // onwebrtcerror: console.trace,\n        onWebRtcConnected(n, o) {\n          self.webRtcState = n;\n          if (n) {\n            self.toUser = this.webRtcUser;\n            self.$message.success("WebRtc 连接成功");\n          } else {\n            self.$message.error("WebRtc 断开连接");\n          }\n        }\n      });\n    }\n  },\n  async mounted() {\n    this.InitWebsocket();\n  },\n  beforeDestroy() {\n    this.websocketApi.Disconnect();\n  }\n}\n<\/script>\n\n<style scoped>\n.item {\n  padding: 0.5em;\n}\n\n.item {\n  text-align: center;\n}\n\n/deep/ .item .el-row .el-col:first-child {\n  text-align: left;\n}\n/deep/ .item .el-row .el-col:last-child {\n  text-align: right;\n}\n</style>\n']}]),e.exports=n},be2a:function(e,n,t){"use strict";var r=t("ecb0"),o=t.n(r);o.a},d914:function(e,n,t){var r=t("203d");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=t("499e").default;o("376c8be6",r,!0,{sourceMap:!0,shadowMode:!1})},e31a:function(e,n,t){var r=t("24fb");n=r(!0),n.push([e.i,"*{padding:0;margin:0;box-sizing:border-box}","",{version:3,sources:["/Volumes/work/golang/kGoChat/k-go-chat-vue/src/src/App.vue"],names:[],mappings:"AAMA,EACA,SAAA,CACA,QAAA,CACA,qBACA",file:"App.vue",sourcesContent:['<template>\n    <div id="app">\n        <router-view/>\n    </div>\n</template>\n<style>\n    * {\n        padding: 0;\n        margin: 0;\n        box-sizing: border-box;\n    }\n</style>\n<style scoped>\n    #app {\n        position: absolute;\n        left: 0;\n        right: 0;\n        top: 0;\n        bottom: 0;\n    }\n\n</style>\n']}]),e.exports=n},ecb0:function(e,n,t){var r=t("6d05");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=t("499e").default;o("1cbc256c",r,!0,{sourceMap:!0,shadowMode:!1})}});
//# sourceMappingURL=app.js.map?v=06fcc1579ff2016ebdf9