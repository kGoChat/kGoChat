(function(e){function t(t){for(var r,i,s=t[0],c=t[1],u=t[2],f=0,d=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(d.length)d.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("3ebb"),o=n.n(r);o.a},"0fd1":function(e,t,n){n("d3b7"),n("4d63"),n("ac1f"),n("25f0"),n("5319");var r=n("7037");(function(){var e=function(e){if(arguments.length>0){var t=this;if(1===arguments.length&&"object"===r(e))for(var n in e){var o=new RegExp("({"+n+"})","g");e.hasOwnProperty(n)&&(t=t.replace(o,e[n]))}else for(var a=0;a<arguments.length;a++){if(void 0===arguments[a])return"";var i=new RegExp("({["+a+"]})","g");t=t.replace(i,arguments[a])}return t}return this};Object.defineProperty(String.prototype,"format",{enumerable:!1,configurable:!1,get:function(){return e.bind(this)}}),Object.defineProperty(String.prototype,"toDate",{enumerable:!1,configurable:!1,get:function(){var e=this;return function(){return new Date(Date.parse(e))}}});var t={"y+":function(e,t){e.setFullYear(e.getFullYear()+t)},"M+":function(e,t){e.setMonth(e.getMonth()+t)},"d+":function(e,t){e.setDate(e.getDate()+t)},"h+":function(e,t){e.setHours(e.getHours()+t)},"m+":function(e,t){e.setMinutes(e.getMinutes()+t)},"s+":function(e,t){e.setSeconds(e.getSeconds()+t)},S:function(e,t){e.setMilliseconds(e.getMilliseconds()+t)}},n=function(e,n){switch(e){case"y":t["y+"](this,n);break;case"M":t["M+"](this,n);break;case"d":t["d+"](this,n);break;case"h":t["h+"](this,n);break;case"m":t["m+"](this,n);break;case"s":t["s+"](this,n);break;case"S":t["S"](this,n);break;default:break}return this},o=function(e){if(!e)return this.toString();for(var n in t)if(new RegExp(n+"([\\+-]{1}\\d+)+").test(e)){var r=parseInt(RegExp.$1);this.Add(n[0],r),e=e.replace(RegExp.$1,"")}var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[a]:("00"+o[a]).substr((""+o[a]).length)));return e};Object.defineProperty(Date.prototype,"format",{enumerable:!1,configurable:!1,get:function(){return o.bind(this)}}),Object.defineProperty(Date.prototype,"Add",{enumerable:!1,configurable:!1,get:function(){return n.bind(this)}});var a=Date.parse,i=/[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*(\d*)[^\d]*/g;Date.parse=function(e){var t=a.bind(this)(e);if(!t){var n=new RegExp(i).exec(e);if(null!=n){for(var r=1;r<n.length;r++)n[r]=parseInt(n[r]),n[r]||(n[r]=0);t=new Date(n[1],n[2]-1,n[3],n[4],n[5],n[6]).getTime()}}return t}})()},"0fe2":function(e,t,n){"use strict";var r=n("d914"),o=n.n(r);o.a},"203d":function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,"#app[data-v-053f99e5]{position:absolute;left:0;right:0;top:0;bottom:0}",""]),e.exports=t},"3ebb":function(e,t,n){var r=n("e31a");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("499e").default;o("517436b3",r,!0,{sourceMap:!1,shadowMode:!1})},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],i=(n("034f"),n("0fe2"),n("2877")),s={},c=Object(i["a"])(s,o,a,!1,null,"053f99e5",null),u=c.exports,l=n("5c96"),f=n.n(l),d=(n("0fae"),n("8c4f")),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("div",{staticStyle:{padding:"0.5em"}},[n("el-card",{staticClass:"box-card",staticStyle:{width:"600px","max-width":"100%"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("账户登录")])]),n("div",{staticClass:"item"},[n("el-row",[n("el-col",{attrs:{span:20}},[n("el-input",{model:{value:e.user,callback:function(t){e.user=t},expression:"user"}},[n("template",{slot:"prepend"},[e._v("登录用户")])],2)],1),n("el-col",{attrs:{span:4}},[n("el-button",{on:{click:function(t){return e.Login()}}},[e._v("登录")])],1)],1)],1),n("div",{staticClass:"item"},[n("el-row",[n("el-col",{attrs:{span:24}},[n("el-input",{model:{value:e.toUser,callback:function(t){e.toUser=t},expression:"toUser"}},[n("template",{slot:"prepend"},[e._v("用户")])],2)],1)],1)],1),n("div",{staticClass:"item"},[n("el-row",[n("el-col",{attrs:{span:20}},[n("el-input",{model:{value:e.message,callback:function(t){e.message=t},expression:"message"}},[n("template",{slot:"prepend"},[e._v("消息")])],2)],1),n("el-col",{attrs:{span:4}},[n("el-button",{on:{click:function(t){return e.sendChat()}}},[e._v("发送")])],1)],1)],1),n("div",{staticClass:"item"},[n("el-row",[n("el-col",{attrs:{span:4}},[e._v(" 消息 ")]),n("el-col",{attrs:{span:20}},[n("el-input",{attrs:{type:"textarea",readonly:"readonly",rows:"5","show-word-limit":""},model:{value:e.other_message,callback:function(t){e.other_message=t},expression:"other_message"}})],1)],1)],1),n("div",{staticClass:"item"},[n("el-row",[n("el-col",{attrs:{span:22}},[n("el-button",{on:{click:function(t){return e.InitWebRTC()}}},[e._v("建立 WebRTC 通道")])],1),n("el-col",{attrs:{span:2}},[n("el-switch",{attrs:{"aria-readonly":"true",readonly:"readonly",disabled:"disabled","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.webRtcState,callback:function(t){e.webRtcState=t},expression:"webRtcState"}})],1)],1)],1)])],1),e._e()],1)},h=[],b=(n("99af"),n("96cf"),n("1da1")),g=(n("d3b7"),n("ac1f"),n("5319"),n("c975"),n("25f0"),n("53ca")),v=0,m=1,w=2,y=4,C="iris-websocket-message:",k=";",R=C.length,O=k.length,x=R+O-1,_=function(){function e(e,t){var n=this;this.connectListeners=[],this.disconnectListeners=[],this.nativeMessageListeners=[],this.messageListeners={},window["WebSocket"]&&(-1===e.indexOf("ws")&&(e="ws://"+e),null!=t&&t.length>0?this.conn=new WebSocket(e,t):this.conn=new WebSocket(e),this.conn.onopen=function(e){return n.fireConnect(),n.isReady=!0,null},this.conn.onclose=function(e){return n.fireDisconnect(),null},this.conn.onmessage=function(e){n.messageReceivedFromConn(e)})}return e.prototype.isNumber=function(e){return!isNaN(e-0)&&null!==e&&""!==e&&!1!==e},e.prototype.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},e.prototype.isBoolean=function(e){return"boolean"===typeof e||"object"===Object(g["a"])(e)&&"boolean"===typeof e.valueOf()},e.prototype.isJSON=function(e){return"object"===Object(g["a"])(e)},e.prototype._msg=function(e,t,n){return C+e+k+String(t)+k+n},e.prototype.encodeMessage=function(e,t){var n="",r=0;return this.isNumber(t)?(r=m,n=t.toString()):this.isBoolean(t)?(r=w,n=t.toString()):this.isString(t)?(r=v,n=t.toString()):this.isJSON(t)?(r=y,n=JSON.stringify(t)):null!==t&&"undefined"!==typeof t&&console.log("unsupported type of input argument passed, try to not include this argument to the 'Emit'"),this._msg(e,r,n)},e.prototype.decodeMessage=function(e,t){var n=R+O+e.length+2;if(t.length<n+1)return null;var r=parseInt(t.charAt(n-2)),o=t.substring(n,t.length);return r===m?parseInt(o):r===w?Boolean(o):r===v?o:r===y?JSON.parse(o):null},e.prototype.getWebsocketCustomEvent=function(e){if(e.length<x)return"";var t=e.substring(x,e.length);return t.substring(0,t.indexOf(k))},e.prototype.getCustomMessage=function(e,t){var n=t.indexOf(e+k);return t.substring(n+e.length+k.length+2,t.length)},e.prototype.messageReceivedFromConn=function(e){var t=e.data;if(-1!==t.indexOf(C)){var n=this.getWebsocketCustomEvent(t);if(""!==n)return void this.fireMessage(n,this.getCustomMessage(n,t))}this.fireNativeMessage(t)},e.prototype.OnConnect=function(e){this.isReady&&e(),this.connectListeners.push(e)},e.prototype.fireConnect=function(){for(var e=0;e<this.connectListeners.length;e++)this.connectListeners[e]()},e.prototype.OnDisconnect=function(e){this.disconnectListeners.push(e)},e.prototype.fireDisconnect=function(){for(var e=0;e<this.disconnectListeners.length;e++)this.disconnectListeners[e]()},e.prototype.OnMessage=function(e){this.nativeMessageListeners.push(e)},e.prototype.fireNativeMessage=function(e){for(var t=0;t<this.nativeMessageListeners.length;t++)this.nativeMessageListeners[t](e)},e.prototype.On=function(e,t){null!=this.messageListeners[e]&&void 0!==this.messageListeners[e]||(this.messageListeners[e]=[]),this.messageListeners[e].push(t)},e.prototype.fireMessage=function(e,t){for(var n in this.messageListeners)if(this.messageListeners.hasOwnProperty(n)&&n===e)for(var r=0;r<this.messageListeners[n].length;r++)this.messageListeners[n][r](t)},e.prototype.Disconnect=function(){this.conn.close()},e.prototype.EmitMessage=function(e){this.conn.send(e)},e.prototype.Emit=function(e,t){var n=this.encodeMessage(e,t);this.EmitMessage(n)},e}(),j=_,S=(n("fb6a"),n("c19f"),n("3ca3"),n("5cc6"),n("84c3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d"),function(e){if(!e instanceof File)throw new Error("非文件");var t=this,n=e.size;Object.defineProperty(this,"FileTotal",{enumerable:!1,configurable:!1,get:function(){return n}}),Object.defineProperty(this,"file",{enumerable:!1,configurable:!1,get:function(){return e}});var r=new FileReader;Object.defineProperty(this,"reader",{enumerable:!1,configurable:!1,get:function(){return r}});var o=function(){t.reader.onprogress=function(e){}};o()});S.prototype={loaded:0,step:262144,readBlob:function(){var e=this;if(this.isReadEnd)throw new Error("文件已读取完毕");var t,n=this.file;if(n.slice){var r=this.loaded*this.step;t=n.slice(r,r+this.step)}else t=n;var o=this;return new Promise((function(n,r){o.reader.onload=function(e){o.loaded++,n(e.target.result)},o.reader.onerror=r,e.reader.readAsDataURL(t)}))}},Object.defineProperty(S.prototype,"isReadEnd",{enumerable:!1,configurable:!1,get:function(){return!(this.loaded*this.step<this.FileTotal)}}),S.ArrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},S.StringToArrayBuffer=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,o=e.length;r<o;r++)n[r]=e.charCodeAt(r);return t},S.Base64ToArrayBuffer=function(e){for(var t=atob(e),n=new ArrayBuffer(t.length),r=new Uint8Array(n),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return n},S.SaveFile=function(e,t,n){var r=new Uint8Array(e),o=new Blob([r]);if(navigator.appVersion.toString().indexOf(".NET")>0)window.navigator.msSaveBlob(o,t);else{var a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=t,document.body.appendChild(a),a.click()}};var T=S,M=function(e){var t=this,n=null;this.connected=!1;var r=e.peerConfigure||e.peerConnectionConfigure||null;e.mediaConstraints=e.mediaConstraints||{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};var o=new RTCPeerConnection(r),a=function(){n.binaryType="arraybuffer",n.addEventListener("open",t._onopen),n.addEventListener("close",t._onclose),n.addEventListener("error",t._onerror),n.addEventListener("message",t._onmessage)};o.onicecandidate=function(t){if(t.candidate){var n={type:"candidate",label:t.candidate.sdpMLineIndex,id:t.candidate.sdpMid,candidate:t.candidate};e.onicecandidate&&e.onicecandidate(n)}},o.ondatachannel=function(e){n=e.channel,a()},Object.defineProperties(this,{$option:{value:e,configurable:!1,enumerable:!1},peerConnection:{value:o,configurable:!1,enumerable:!0,writable:!1},_localChannel:{get:function(){return n},set:function(e){n&&(n.close(),n=null),n=e},configurable:!1,enumerable:!0},_DataChannelLabel:{get:function(){return e.DataChannelLabel||e.ChannelLabel||e.data_channel_label||"kGoChat"},configurable:!1,enumerable:!0},_onopen:{configurable:!1,enumerable:!1,get:function(){return function(n){t.connected=!0;var r=e.onOpen||e.onopen||console.trace;r.call(t,n)}}},_onclose:{configurable:!1,enumerable:!1,get:function(){return function(n){t.connected=!1;var r=e.onClose||e.onclose||console.trace;r.call(t,n)}}},_onerror:{configurable:!1,enumerable:!1,get:function(){return function(n){var r=e.onError||e.onerror||console.trace;r.call(t,n)}}},_onmessage:{configurable:!1,enumerable:!1,get:function(){return function(n){var r=e.onMessage||e.onmessage||console.trace;r.call(t,n,n.data)}}}});var i=!1;if(Object.defineProperty(this,"addIceCandidate",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}e.prev=1,t=JSON.parse(t),e.next=8;break;case 5:throw e.prev=5,e.t0=e["catch"](1),e.t0;case 8:if(!i){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,i=!0,e.next=14,o.addIceCandidate(t);case 14:return e.abrupt("return",e.sent);case 17:throw e.prev=17,e.t1=e["catch"](10),i=!1,e.t1;case 21:case"end":return e.stop()}}),e,null,[[1,5],[10,17]])})));return function(t){return e.apply(this,arguments)}}()}}),e.master){var s={ordered:!0},c=t.peerConnection;this._localChannel=c.createDataChannel(t._DataChannelLabel,s),this._localChannel.binaryType="arraybuffer",a()}};Object.defineProperty(M.prototype,"type",{value:"WebRTC",configurable:!1,writable:!1}),Object.defineProperty(M.prototype,"createOffer",{configurable:!1,get:function(){return function(){var e=this;return new Promise(function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(n,r){var o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e.peerConnection,t.next=3,o.createOffer(e.$option.mediaConstraints);case 3:return a=t.sent,t.next=6,o.setLocalDescription(a);case 6:n(a);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}}),Object.defineProperty(M.prototype,"send",{configurable:!1,get:function(){return function(e){var t=this;return new Promise(function(){var n=Object(b["a"])(regeneratorRuntime.mark((function n(r,o){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t._localChannel.send(e);case 2:r();case 3:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}}}),Object.defineProperty(M.prototype,"close",{configurable:!1,get:function(){return function(){var e=this;return new Promise(function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(n,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=e._localChannel,!t.t0){t.next=4;break}return t.next=4,e._localChannel.close();case 4:n();case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}}}),Object.defineProperty(M.prototype,"handleOffer",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}e.prev=1,t=JSON.parse(t),e.next=9;break;case 5:return e.prev=5,e.t0=e["catch"](1),console.trace(e.t0),e.abrupt("return");case 9:return n=this.peerConnection,e.next=12,n.setRemoteDescription(new RTCSessionDescription(t));case 12:return e.next=14,n.createAnswer();case 14:return r=e.sent,e.next=17,n.setLocalDescription(r);case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(t){return e.apply(this,arguments)}}()}}),Object.defineProperty(M.prototype,"handleAnswer",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}e.prev=1,t=JSON.parse(t),e.next=9;break;case 5:return e.prev=5,e.t0=e["catch"](1),console.trace(e.t0),e.abrupt("return");case 9:return n=this.peerConnection,e.next=12,n.setRemoteDescription(new RTCSessionDescription(t));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(t){return e.apply(this,arguments)}}()}}),Object.defineProperty(M.prototype,"handleCandidate",{configurable:!1,get:function(){return function(){var e=Object(b["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.peerConnection,e.next=3,n.addIceCandidate(new RTCIceCandidate(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}}),window.WebRTC=M;var W=M,P=(n("3fd3"),function(e){var t="".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.host,"/websocket"),n=new j(t),r=this,o=0;this.callback_lists=[],Object.defineProperty(this,"callback_list_index",{enumerable:!1,configurable:!1,get:function(){return o++,o>99999999&&(o=1),o}}),n.OnConnect((function(){e.OnConnect&&e.OnConnect.call(r)})),n.On("Chat",(function(t){try{t=JSON.parse(t)}catch(o){}var n=t.fnId;if(delete t.fnId,t.code>=0){if(n&&r.callback_lists[n]){try{r.callback_lists[n][0](t)}finally{delete r.callback_lists[n]}return}if(n&&r.callback_lists[n]){try{r.callback_lists[n][1](t)}finally{delete r.callback_lists[n]}return}}e.OnChat&&e.OnChat.call(r,t)}));var a="";n.On("User",(function(t){try{t=JSON.parse(t)}catch(o){}var n=t.fnId;if(delete t.fnId,t.code>=0){switch(t.type){case"Login":a=t.data.user;break}if(n&&r.callback_lists[n]){try{r.callback_lists[n][0](t)}finally{delete r.callback_lists[n]}return}}else if(n&&r.callback_lists[n]){try{r.callback_lists[n][1](t)}finally{delete r.callback_lists[n]}return}e.OnUser&&e.OnUser.call(r,t)})),n.On("WebRTC",(function(t){try{t=JSON.parse(t)}catch(a){}var n=t.fnId;if(delete t.fnId,t.code>=0){if("WebRTC"===t.type){var o=t.data;switch(o.type){case"candidate":return void r._update_candidate(o.data).then((function(e){e&&console.log(e)})).catch(console.error);case"offer":return void Object(b["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.InitWebRTC(!1,o.user);case 2:return e.next=4,r._handleOffer(o.data);case 4:t=e.sent,r.sendWebRTC({code:0,type:"WebRTC",data:{type:"answer",user:o.user,data:t},remarks:""});case 6:case"end":return e.stop()}}),e)})))();case"answer":return void r._handleAnswer(o.data).then((function(e){e&&console.log(e)})).catch(console.error)}}else if("WebRTCBack"===t.type&&n&&r.callback_lists[n]){try{r.callback_lists[n][0](t)}finally{delete r.callback_lists[n]}return}}else if(n&&r.callback_lists[n]){try{r.callback_lists[n][1](t)}finally{delete r.callback_lists[n]}return}e.OnWebRTC&&e.OnWebRTC.call(r,t)})),n.OnDisconnect((function(){e.OnDisconnect&&e.OnDisconnect.call(r)})),Object.defineProperty(this,"user",{enumerable:!0,configurable:!1,get:function(){return a}}),Object.defineProperty(this,"$socket",{enumerable:!1,configurable:!1,get:function(){return n}});var i=null;Object.defineProperty(this,"webRTC",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"$option",{enumerable:!1,configurable:!1,get:function(){return e}}),this.offer="{}",this.answer="{}",this.candidate="{}",this.other_candidate="{}",this.webRtcUser="";var s=!1;Object.defineProperty(this,"WebRtcConnected",{enumerable:!1,configurable:!1,get:function(){return s},set:function(t){var n=e.onWebRtcConnected||e.onwebrtcConnected||e.onwebrtcconnected||console.log,o=s;s=t,t!==o&&n&&n.call(r,t,o)}})});P.prototype={Disconnect:function(){this.FreeWebRTC(),this.$socket.Disconnect()},sendChat:function(e){return this.send("Chat",e)},sendWebRTC:function(e){return this.send("WebRTC",e)},sendUser:function(e){return this.send("User",e)},send:function(e,t){var n=this;return new Promise((function(r,o){var a=n.callback_list_index;t.fnId=a,n.callback_lists[a]=[r,o],n.$socket.Emit(e||"Chat",t)}))},peerConnectionConfigure:{iceServers:[{urls:["turn:59.63.25.236:3478?transport=udp","turn:59.63.25.236:3478?transport=tcp"],username:"kekxv",credential:"kekxv"},{urls:["stun:kekxv.com"],username:"",credential:""}],iceTransportPolicy:"all",iceCandidatePoolSize:"0"},InitWebRTC:function(e,t){var n=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){var o,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.FreeWebRTC(),o=n,0!==n.user.length){r.next=4;break}throw{code:-1,message:"请先登录"};case 4:if(0!==t.length&&t!==n.user){r.next=6;break}throw{code:-1,message:"请不要与自己建立"};case 6:if(n.webRtcUser=t,n.webRTC=new W({peerConfigure:n.peerConnectionConfigure,DataChannelLabel:"kGoChat",master:e||!1,onopen:function(e){o.WebRtcConnected=!0},onclose:function(e){o.WebRtcConnected=!1},onerror:function(e){var t=o.$option.onWebRtcError||o.$option.onWebRtcerror||o.$option.onwebrtcerror;t&&t.call(o,e)},onmessage:function(e){var t=o.$option.onWebRTCmessage||o.$option.onWebRtcMessage||o.$option.onwebrtcmessage;t&&t.call(o,e)},onicecandidate:function(e){o.sendWebRTC({code:0,type:"WebRTC",data:{type:"candidate",user:n.webRtcUser,data:JSON.stringify(e.candidate)},remarks:""}).then((function(e){})).catch((function(e){console.log("error","candidate",e)}))}}),!e){r.next=13;break}return r.next=11,n._createOffer();case 11:return a=r.sent,r.abrupt("return",n.sendWebRTC({code:0,type:"WebRTC",data:{type:"offer",user:n.webRtcUser,data:a},remarks:""}).then((function(){})));case 13:case"end":return r.stop()}}),r)})))()},FreeWebRTC:function(){this.webRTC&&this.webRTC.close(),this.webRTC=null,this.WebRtcConnected=!1},_update_candidate:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.webRTC.addIceCandidate(e);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()},_createOffer:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,e.webRTC.createOffer();case 3:return t.t1=t.sent,n=t.t0.stringify.call(t.t0,t.t1),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))()},_handleOffer:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,t.webRTC.handleOffer(e);case 3:return n.t1=n.sent,r=n.t0.stringify.call(n.t0,n.t1),n.abrupt("return",r);case 6:case"end":return n.stop()}}),n)})))()},_handleAnswer:function(e){var t=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.webRTC.handleAnswer(e);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()}};var L=P,D=function(e,t){this.title=e,this.options=t};D.prototype.Show=function(){var e=this;return window.Notification?"granted"===Notification.permission?this.popNotice():"denied"!==Notification.permission&&Notification.requestPermission().then((function(t){console.log(t),"granted"!==Notification.permission?e.popConfirm():e.popNotice()})):this.popConfirm(),this},D.prototype.popNotice=function(){var e=this;if("granted"===Notification.permission){var t=new Notification(e.title,e.options);t.onclick=function(){"undefined"!==typeof e.options.click&&e.options.click.call(e,e.options.data||null),t.close()},t.onclose=function(){"undefined"!==typeof e.options.close&&e.options.close.call(e,e.options.data||null)},t.onerror=function(){"undefined"!==typeof e.options.error&&e.options.error.call(e,e.options.data||null)},t.onshow=function(){"undefined"!==typeof e.options.show&&e.options.show.call(e,e.options.data||null)}}return e},D.prototype.popConfirm=function(){var e=confirm(this.title+"\n"+this.options.body);return"undefined"!==typeof this.options.show&&this.options.show.call(this),e?"undefined"!==typeof this.options.click&&this.options.click.call(this):"undefined"!==typeof this.options.error&&this.options.error.call(this),"undefined"!==typeof this.options.close&&this.options.close.call(this),this};var E={name:"Home",components:{},data:function(){return{user:"caesar",toUser:"caesar",message:"",other_message:"",webRtcState:!1,websocketApi:null,offer:"{}",answer:"{}",candidate:"{}",other_candidate:"{}"}},methods:{read:function(e){return Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.target.files,!(n&&n.length>0)){t.next=10;break}r=new T(n[0]);case 3:if(r.isReadEnd){t.next=9;break}return t.next=6,r.readBlob();case 6:t.sent,t.next=3;break;case 9:console.trace("read end");case 10:case"end":return t.stop()}}),t)})))()},InitWebRTC:function(){var e=this;this.websocketApi.InitWebRTC(!0,this.toUser).then((function(e){})).catch((function(t){e.$message.error(t.message)}))},Login:function(){var e=this;this.websocketApi.sendUser({code:0,type:"Login",data:{user:this.user},remarks:""}).then((function(t){e.$message.success(t.message)})).catch((function(t){e.$message.error(t.message)}))},sendChat:function(){var e=this;this.websocketApi.sendChat({code:0,type:"Chat",data:{user:this.toUser,message:this.message},remarks:""}).then((function(t){e.$message.success(t.message)})).catch((function(t){e.$message.error(t.message)}))},InitWebsocket:function(){var e=this;this.websocketApi=new L({OnConnect:function(){e.$message.success("连接成功")},OnDisconnect:function(){e.$message.warning("连接断开"),setTimeout((function(){e.InitWebsocket()}),3e3)},OnChat:function(t){0===t.code?"ChatBack"===t.type?e.$message.success(t.message):e.other_message="".concat(t.data.user,":").concat(t.data.message):e.$message.error(t.message)},OnUser:console.trace,OnWebRTC:console.trace,onwebrtcmessage:console.trace,onWebRtcConnected:function(t,n){e.webRtcState=t,t?(e.toUser=this.webRtcUser,e.$message.success("WebRtc 连接成功")):e.$message.error("WebRtc 断开连接")}})}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.InitWebsocket();case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.websocketApi.Disconnect()}},N=E,$=(n("be2a"),Object(i["a"])(N,p,h,!1,null,"8b607b64",null)),A=$.exports;r["default"].use(d["a"]);var U=[{path:"/",name:"Home",component:A}],I=new d["a"]({routes:U}),B=I,F=n("2f62");r["default"].use(F["a"]);var J=new F["a"].Store({state:{},mutations:{},actions:{},modules:{}}),H=(n("0fd1"),n("9483"));Object(H["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),r["default"].config.productionTip=!1,r["default"].use(f.a),new r["default"]({router:B,store:J,render:function(e){return e(u)}}).$mount("#app")},"6d05":function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,".item[data-v-8b607b64]{padding:.5em;text-align:center}[data-v-8b607b64] .item .el-row .el-col:first-child{text-align:left}[data-v-8b607b64] .item .el-row .el-col:last-child{text-align:right}",""]),e.exports=t},be2a:function(e,t,n){"use strict";var r=n("ecb0"),o=n.n(r);o.a},d914:function(e,t,n){var r=n("203d");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("499e").default;o("376c8be6",r,!0,{sourceMap:!1,shadowMode:!1})},e31a:function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,"*{padding:0;margin:0;box-sizing:border-box}",""]),e.exports=t},ecb0:function(e,t,n){var r=n("6d05");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("499e").default;o("1cbc256c",r,!0,{sourceMap:!1,shadowMode:!1})}});